<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dá»‹ch HTML Tiáº¿ng Viá»‡t sang HTML Chuáº©n & Render</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter&display=swap');
    :root {
      --bg-color: linear-gradient(135deg, #667eea, #764ba2);
      --text-color: #fff;
      --secondary-text-color: #ddd;
      --primary-color: #764ba2;
      --primary-hover-color: #5a3885;
      --input-bg-color: #f9f9f9;
      --input-text-color: #222;
      --output-bg-color: #2d2d2d;
      --output-text-color: #f8f8f2;
      --rendered-bg-color: white;
      --rendered-text-color: black;
      --lookup-bg-color: rgba(255, 255, 255, 0.1);
      --lookup-border-color: rgba(255, 255, 255, 0.2);
      --lookup-hover-color: rgba(255, 255, 255, 0.2);
      --box-shadow-color: rgba(0, 0, 0, 0.2);
      --box-shadow-strong: rgba(0, 0, 0, 0.3);
    }
    
    body.dark-mode {
      --bg-color: linear-gradient(135deg, #1a1a2e, #16213e);
      --text-color: #eee;
      --secondary-text-color: #aaa;
      --primary-color: #4a69bd;
      --primary-hover-color: #1e3799;
      --input-bg-color: #2c3e50;
      --input-text-color: #ecf0f1;
      --output-bg-color: #1e272e;
      --output-text-color: #d2dae2;
      --rendered-bg-color: #2c3e50;
      --rendered-text-color: #ecf0f1;
      --lookup-bg-color: rgba(0, 0, 0, 0.3);
      --lookup-border-color: rgba(255, 255, 255, 0.1);
      --lookup-hover-color: rgba(0, 0, 0, 0.5);
      --box-shadow-color: rgba(0, 0, 0, 0.4);
      --box-shadow-strong: rgba(0, 0, 0, 0.5);
    }
    
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: all 0.3s ease;
    }
    
    header {
      text-align: center;
      padding: 30px 20px 10px;
      max-width: 900px;
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    
    p {
      margin-top: 0;
      color: var(--secondary-text-color);
    }
    
    main {
      display: flex;
      gap: 20px;
      padding: 20px;
      max-width: 960px;
      width: 100%;
      flex-wrap: wrap;
    }
    
    textarea {
      flex: 1;
      min-height: 400px;
      width: 100%;
      padding: 15px;
      border-radius: 10px;
      font-family: monospace;
      font-size: 1rem;
      border: none;
      resize: vertical;
      box-shadow: 0 4px 10px var(--box-shadow-color);
      background: var(--input-bg-color);
      color: var(--input-text-color);
      line-height: 1.5;
      transition: all 0.3s ease;
    }
    
    pre#output {
      flex: 1;
      min-height: 400px;
      width: 90%;
      max-width: 960px;
      background: var(--output-bg-color);
      color: var(--output-text-color);
      padding: 15px;
      border-radius: 10px;
      overflow: auto;
      margin: 20px;
      font-family: monospace;
      line-height: 1.5;
      transition: all 0.3s ease;
    }
    
    .btn {
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 30px;
      font-size: 1.1rem;
      cursor: pointer;
      margin: 10px;
      transition: all 0.3s ease;
    }
    
    .btn:hover {
      background: var(--primary-hover-color);
    }
    
    .btn-small {
      padding: 8px 15px;
      font-size: 0.9rem;
      border-radius: 20px;
    }
    
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 10px;
      width: 90%;
      max-width: 960px;
      margin: 10px 0;
    }
    
    #rendered {
      background: var(--rendered-bg-color);
      color: var(--rendered-text-color);
      width: 90%;
      max-width: 900px;
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px var(--box-shadow-strong);
      transition: all 0.3s ease;
    }
    
    footer {
      font-size: 0.9rem;
      padding: 20px;
      color: var(--secondary-text-color);
      text-align: center;
    }
    
    /* Báº£ng tra cá»©u */
    #lookupTable {
      width: 90%;
      max-width: 960px;
      max-height: 400px;
      overflow: auto;
      background: var(--lookup-bg-color);
      border-radius: 10px;
      padding: 15px;
      margin: 20px;
      border: 1px solid var(--lookup-border-color);
      display: none;
      transition: all 0.3s ease;
    }
    
    .lookup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .lookup-search {
      padding: 8px 15px;
      border-radius: 20px;
      border: none;
      background: var(--input-bg-color);
      color: var(--input-text-color);
      width: 250px;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }
    
    .lookup-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
    }
    
    .lookup-item {
      background: var(--lookup-bg-color);
      padding: 10px;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      transition: all 0.2s ease;
    }
    
    .lookup-item:hover {
      background: var(--lookup-hover-color);
    }
    
    .lookup-viet {
      font-weight: bold;
    }
    
    .lookup-html {
      color: var(--secondary-text-color);
    }
    
    /* Chuyá»ƒn Ä‘á»•i cháº¿ Ä‘á»™ sÃ¡ng/tá»‘i */
    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .toggle-slider {
      background-color: var(--primary-color);
    }
    
    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }
  </style>
</head>
<body>

  <header>
    <h1>Dá»‹ch HTML Tiáº¿ng Viá»‡t sang HTML Chuáº©n & Render</h1>
    <p>Nháº­p mÃ£ HTML Tiáº¿ng Viá»‡t â†’ Dá»‹ch â†’ Xem káº¿t quáº£ vÃ  giao diá»‡n hiá»ƒn thá»‹ trá»±c tiáº¿p</p>
    <div class="theme-toggle">
      <span>ðŸŒž</span>
      <label class="toggle-switch">
        <input type="checkbox" id="themeToggle">
        <span class="toggle-slider"></span>
      </label>
      <span>ðŸŒ™</span>
    </div>
  </header>

  <main>
    <textarea id="inputCode" placeholder="<tieude>Trang Chá»§</tieude>"></textarea>
  </main>
  
  <div class="controls">
    <button id="btnTranslate" class="btn">Dá»‹ch sang HTML chuáº©n</button>
    <button id="btnToggleLookup" class="btn btn-small">Hiá»‡n báº£ng tra cá»©u</button>
  </div>
  
  <div id="lookupTable">
    <div class="lookup-header">
      <h3>Báº£ng tra cá»©u mÃ£ dá»‹ch</h3>
      <input type="text" class="lookup-search" id="lookupSearch" placeholder="TÃ¬m kiáº¿m...">
    </div>
    <div class="lookup-grid" id="lookupGrid">
      <!-- Dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c thÃªm vÃ o Ä‘Ã¢y báº±ng JavaScript -->
    </div>
  </div>
  
  <pre id="output">(Káº¿t quáº£ dá»‹ch sáº½ hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y)</pre>

  <div id="rendered">(Giao diá»‡n web hiá»‡n ra Ä‘Ã¢y)</div>

  <footer>
    Â© 2025 - Dá»‹ch HTML tiáº¿ng Viá»‡t | Dá»¯ liá»‡u tra cá»©u náº±m trong <code>data.json</code>
  </footer>

  <script>
    let translationMap = {};
    let lookupVisible = false;
    let darkMode = false;

    async function loadTranslationMap() {
      try {
        const response = await fetch("data.json");
        translationMap = await response.json();
        populateLookupTable(translationMap);
      } catch (e) {
        alert("KhÃ´ng thá»ƒ táº£i file data.json!");
        console.error(e);
      }
    }
    
    function populateLookupTable(data) {
      const lookupGrid = document.getElementById("lookupGrid");
      lookupGrid.innerHTML = "";
      
      // Sáº¯p xáº¿p cÃ¡c cáº·p khÃ³a-giÃ¡ trá»‹ theo khÃ³a (tiáº¿ng Viá»‡t)
      const sortedEntries = Object.entries(data).sort((a, b) => a[0].localeCompare(b[0]));
      
      for (const [vietTag, htmlTag] of sortedEntries) {
        const item = document.createElement("div");
        item.className = "lookup-item";
        item.innerHTML = `
          <span class="lookup-viet">&lt;${vietTag}&gt;</span>
          <span class="lookup-html">&lt;${htmlTag}&gt;</span>
        `;
        
        // ThÃªm sá»± kiá»‡n click Ä‘á»ƒ chÃ¨n mÃ£ vÃ o textarea
        item.addEventListener("click", () => {
          const textarea = document.getElementById("inputCode");
          const startPos = textarea.selectionStart;
          const endPos = textarea.selectionEnd;
          const currentValue = textarea.value;
          const newValue = currentValue.substring(0, startPos) + 
                          `<${vietTag}></${vietTag}>` + 
                          currentValue.substring(endPos);
          textarea.value = newValue;
          // Di chuyá»ƒn con trá» vÃ o giá»¯a tháº»
          const cursorPos = startPos + vietTag.length + 2;
          textarea.setSelectionRange(cursorPos, cursorPos);
          textarea.focus();
        });
        
        lookupGrid.appendChild(item);
      }
    }
    
    function filterLookupTable(searchTerm) {
      const lookupItems = document.querySelectorAll(".lookup-item");
      const searchLower = searchTerm.toLowerCase();
      
      lookupItems.forEach(item => {
        const vietTag = item.querySelector(".lookup-viet").textContent.toLowerCase();
        const htmlTag = item.querySelector(".lookup-html").textContent.toLowerCase();
        
        if (vietTag.includes(searchLower) || htmlTag.includes(searchLower)) {
          item.style.display = "flex";
        } else {
          item.style.display = "none";
        }
      });
    }

    function formatHTML(html) {
      // Tá»± Ä‘á»™ng cÄƒn chá»‰nh thá»¥t lÃ¹i Ä‘áº§u dÃ²ng
      let formatted = '';
      let indent = 0;
      const lines = html.split('\n');
      
      for (let i = 0; i < lines.length; i++) {
        let line = lines[i].trim();
        if (!line) continue;
        
        // Giáº£m thá»¥t lÃ¹i cho tháº» Ä‘Ã³ng
        if (line.match(/^<\/[^>]+>/) && indent > 0) {
          indent--;
        }
        
        // ThÃªm thá»¥t lÃ¹i vÃ o dÃ²ng hiá»‡n táº¡i
        formatted += '  '.repeat(indent) + line + '\n';
        
        // TÄƒng thá»¥t lÃ¹i cho tháº» má»Ÿ (khÃ´ng pháº£i tháº» tá»± Ä‘Ã³ng)
        if (line.match(/^<[^/][^>]*>/) && !line.match(/\/>$/) && !line.match(/<(img|br|hr|input|meta|link)[^>]*>$/i)) {
          indent++;
        }
      }
      
      return formatted;
    }
    
    function autoCloseTag(input) {
      // Tá»± Ä‘á»™ng Ä‘Ã³ng tháº»
      const openTags = [];
      let result = input;
      
      // TÃ¬m táº¥t cáº£ cÃ¡c tháº» má»Ÿ
      const openTagRegex = /<([a-zA-Z0-9_-]+)(\s[^>]*)?>/g;
      let match;
      
      while ((match = openTagRegex.exec(input)) !== null) {
        const tagName = match[1];
        const selfClosing = ['img', 'br', 'hr', 'input', 'meta', 'link'].includes(tagName.toLowerCase());
        
        if (!selfClosing) {
          openTags.push(tagName);
        }
      }
      
      // ThÃªm tháº» Ä‘Ã³ng cho cÃ¡c tháº» chÆ°a Ä‘Æ°á»£c Ä‘Ã³ng (theo thá»© tá»± ngÆ°á»£c láº¡i)
      for (let i = openTags.length - 1; i >= 0; i--) {
        const tagName = openTags[i];
        const htmlTagName = translationMap[tagName] || tagName; // Láº¥y tÃªn tháº» HTML tÆ°Æ¡ng á»©ng náº¿u cÃ³
        
        // Kiá»ƒm tra cáº£ tháº» tiáº¿ng Viá»‡t vÃ  tháº» HTML tÆ°Æ¡ng á»©ng
        const hasClosingTag = result.includes(`</${tagName}>`) || 
                             result.includes(`</${tagName.toLowerCase()}>`) ||
                             result.includes(`</${htmlTagName}>`) || 
                             result.includes(`</${htmlTagName.toLowerCase()}>`);
        
        if (!hasClosingTag) {
          result += `\n</${tagName}>`;
        }
      }
      
      return result;
    }
    
    function translateHTML() {
      if (Object.keys(translationMap).length === 0) {
        alert("Báº£ng dá»‹ch chÆ°a Ä‘Æ°á»£c táº£i.");
        return;
      }

      let input = document.getElementById("inputCode").value;
      
      // ThÃªm sá»± kiá»‡n tá»± Ä‘á»™ng Ä‘Ã³ng tháº» khi nháº¥n Enter
      document.getElementById("inputCode").addEventListener("keydown", function(e) {
        if (e.key === "Enter") {
          const cursorPos = this.selectionStart;
          const textBeforeCursor = this.value.substring(0, cursorPos);
          const lastOpenTagMatch = textBeforeCursor.match(/<([a-zA-Z0-9_-]+)(?:\s[^>]*)?>[^<]*$/i);
          
          if (lastOpenTagMatch && !['img', 'br', 'hr', 'input', 'meta', 'link'].includes(lastOpenTagMatch[1].toLowerCase())) {
            const tagName = lastOpenTagMatch[1];
            const currentValue = this.value;
            const newValue = currentValue.substring(0, cursorPos) + "\n" + 
                            "  " + currentValue.substring(cursorPos, currentValue.length) + 
                            "\n" + `</${tagName}>`;
            
            this.value = newValue;
            this.setSelectionRange(cursorPos + 3, cursorPos + 3);
            e.preventDefault();
          }
        }
      });

      // Tá»± Ä‘á»™ng Ä‘Ã³ng tháº»
      input = autoCloseTag(input);

      // Dá»‹ch DOCTYPE
      input = input.replace(/<!phan_cu_the\s+html>/gi, "<!DOCTYPE html>");

      // Dá»‹ch tháº» má»Ÿ vÃ  Ä‘Ã³ng
      for (const [vietTag, htmlTag] of Object.entries(translationMap)) {
        if (vietTag === "phan_cu_the") continue;

        const openTag = new RegExp(`<${vietTag}(\\s[^>]*)?>`,"gi");
        input = input.replace(openTag, `<${htmlTag}$1>`);

        const closeTag = new RegExp(`</${vietTag}>`, "gi");
        input = input.replace(closeTag, `</${htmlTag}>`);
      }

      // Dá»‹ch class="..."
      input = input.replace(/class="([^"]+)"/gi, (match, value) => {
        const translated = value
          .split(/\s+/)
          .map(word => translationMap[word] || word)
          .join(" ");
        return `class="${translated}"`;
      });
      
      // Äá»‹nh dáº¡ng HTML vá»›i thá»¥t lÃ¹i Ä‘áº§u dÃ²ng
      const formattedHTML = formatHTML(input);

      document.getElementById("output").innerText = formattedHTML;
      document.getElementById("rendered").innerHTML = input;
    }
    
    function toggleLookupTable() {
      const lookupTable = document.getElementById("lookupTable");
      const btnToggleLookup = document.getElementById("btnToggleLookup");
      
      lookupVisible = !lookupVisible;
      
      if (lookupVisible) {
        lookupTable.style.display = "block";
        btnToggleLookup.textContent = "áº¨n báº£ng tra cá»©u";
      } else {
        lookupTable.style.display = "none";
        btnToggleLookup.textContent = "Hiá»‡n báº£ng tra cá»©u";
      }
    }
    
    function toggleDarkMode() {
      darkMode = !darkMode;
      document.body.classList.toggle("dark-mode", darkMode);
      
      // LÆ°u tráº¡ng thÃ¡i cháº¿ Ä‘á»™ vÃ o localStorage
      localStorage.setItem("darkMode", darkMode);
    }
    
    function initApp() {
      // Táº£i báº£ng dá»‹ch
      loadTranslationMap();
      
      // Khá»Ÿi táº¡o sá»± kiá»‡n cho cÃ¡c nÃºt
      document.getElementById("btnTranslate").addEventListener("click", translateHTML);
      document.getElementById("btnToggleLookup").addEventListener("click", toggleLookupTable);
      document.getElementById("themeToggle").addEventListener("change", toggleDarkMode);
      
      // Khá»Ÿi táº¡o sá»± kiá»‡n tÃ¬m kiáº¿m
      document.getElementById("lookupSearch").addEventListener("input", (e) => {
        filterLookupTable(e.target.value);
      });
      
      // ThÃªm sá»± kiá»‡n tá»± Ä‘á»™ng Ä‘Ã³ng tháº» khi nháº­p
      document.getElementById("inputCode").addEventListener("input", function(e) {
        // Kiá»ƒm tra náº¿u ngÆ°á»i dÃ¹ng vá»«a nháº­p dáº¥u >
        if (e.inputType === "insertText" && e.data === ">") {
          const cursorPos = this.selectionStart;
          const textBeforeCursor = this.value.substring(0, cursorPos);
          const lastOpenTagMatch = textBeforeCursor.match(/<([a-zA-Z0-9_-]+)(?:\s[^>]*)?>[^<]*$/i);
          
          if (lastOpenTagMatch && !['img', 'br', 'hr', 'input', 'meta', 'link'].includes(lastOpenTagMatch[1].toLowerCase())) {
            const tagName = lastOpenTagMatch[1];
            const currentValue = this.value;
            const newValue = currentValue.substring(0, cursorPos) + 
                            `</${tagName}>` + 
                            currentValue.substring(cursorPos);
            
            this.value = newValue;
            this.setSelectionRange(cursorPos, cursorPos);
          }
        }
      });
      
      // KhÃ´i phá»¥c cháº¿ Ä‘á»™ sÃ¡ng/tá»‘i tá»« localStorage
      const savedDarkMode = localStorage.getItem("darkMode") === "true";
      if (savedDarkMode) {
        darkMode = true;
        document.body.classList.add("dark-mode");
        document.getElementById("themeToggle").checked = true;
      }
    }

    window.onload = initApp;
  </script>

</body>
</html>
